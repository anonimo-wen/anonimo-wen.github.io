<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora VLSM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Segoe UI',Tahoma,sans-serif;
}
body{
    background:linear-gradient(135deg,#1a2980,#26d0ce);
    min-height:100vh;
    padding:20px;
}
.container{
    max-width:1400px;
    margin:auto;
    background:rgba(255,255,255,.95);
    border-radius:15px;
    box-shadow:0 15px 35px rgba(0,0,0,.2);
    overflow:hidden;
}
header{
    background:linear-gradient(135deg,#2c3e50,#4a6491);
    color:white;
    padding:30px;
    text-align:center;
}
header h1{
    font-size:2.4rem;
}
.subtitle{
    opacity:.9;
}
.main-content{
    padding:30px;
}
.input-section{
    background:#f8f9fa;
    padding:25px;
    border-radius:10px;
    border:2px solid #e9ecef;
}
label{
    font-weight:600;
    margin-bottom:5px;
    display:block;
}
input{
    width:100%;
    padding:12px;
    border-radius:8px;
    border:2px solid #ccc;
    margin-bottom:15px;
}
button{
    padding:12px 25px;
    border:none;
    border-radius:8px;
    font-weight:600;
    cursor:pointer;
}
#btn-calcular{
    background:linear-gradient(to right,#2ecc71,#27ae60);
    color:white;
}
.loading{
    display:none;
    text-align:center;
    margin-top:20px;
}
.spinner{
    width:40px;
    height:40px;
    border:4px solid #eee;
    border-top:4px solid #3498db;
    border-radius:50%;
    animation:spin 1s linear infinite;
    margin:auto;
}
@keyframes spin{100%{transform:rotate(360deg)}}

.error-message{
    display:none;
    background:#fee;
    color:#c0392b;
    padding:15px;
    border-left:5px solid #c0392b;
    margin-top:15px;
}

.stats{
    display:flex;
    gap:20px;
    margin:25px 0;
    flex-wrap:wrap;
}
.stat-box{
    flex:1;
    min-width:200px;
    background:linear-gradient(135deg,#3498db,#2980b9);
    color:white;
    padding:20px;
    border-radius:8px;
}
.stat-value{
    font-size:1.8rem;
    font-weight:bold;
}
.stat-label{
    opacity:.9;
    font-size:.9rem;
}

.result-section{
    background:white;
    padding:20px;
    border-radius:10px;
    border:2px solid #e9ecef;
    overflow-x:auto;
}
table{
    width:100%;
    min-width:1200px;
    border-collapse:collapse;
}
th{
    background:#34495e;
    color:white;
    padding:15px;
    position:sticky;
    top:0;
}
td{
    padding:12px;
    border-bottom:1px solid #eee;
    font-family:Consolas,monospace;
}
tr:hover{background:#f8f9fa}
.ip-cell{
    background:#e8f4fc;
    padding:3px 6px;
    border-radius:4px;
}
footer{
    background:#2c3e50;
    color:white;
    text-align:center;
    padding:20px;
    margin-top:30px;
}
</style>
</head>

<body>
<div class="container">
<header>
    <h1>Calculadora VLSM</h1>
    <p class="subtitle">Subneteo de Longitud Variable</p>
</header>

<div class="main-content">

<div class="input-section">
    <label>Dirección IP Base</label>
    <input id="ip-base" value="192.168.27.0">

    <label>Hosts por subred (coma)</label>
    <input id="hosts" value="4000,1000,200,2,2">

    <button id="btn-calcular">Calcular VLSM</button>

    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Calculando subredes VLSM...</p>
    </div>

    <div id="error-message" class="error-message"></div>
</div>

<div class="stats" id="stats"></div>

<div class="result-section">
<table>
<thead>
<tr>
<th>IP Red</th>
<th>Prefijo</th>
<th>Máscara</th>
<th>Hosts Req</th>
<th>Hosts Disp</th>
<th>Primer Host</th>
<th>Último Host</th>
<th>Broadcast</th>
</tr>
</thead>
<tbody id="tabla-body">
<tr>
<td colspan="8" style="text-align:center;padding:30px;">
Ingrese los datos y presione Calcular
</td>
</tr>
</tbody>
</table>
</div>

</div>

<footer>
<p>Calculadora VLSM</p>
</footer>
</div>

<script>
// ===== IP UTILIDADES SEGURAS =====
function ipToInt(ip){
    const [a,b,c,d]=ip.split('.').map(Number);
    return a*256**3+b*256**2+c*256+d;
}
function intToIp(n){
    return[
        Math.floor(n/256**3)%256,
        Math.floor(n/256**2)%256,
        Math.floor(n/256)%256,
        n%256
    ].join('.');
}
function mascaraDesdePrefijo(p){
    let m=0;
    for(let i=0;i<p;i++) m+=2**(31-i);
    return intToIp(m);
}
function redBase24(ip){
    const p=ip.split('.').map(Number);
    return p[0]*256**3+p[1]*256**2+p[2]*256;
}

// ===== VLSM (IGUAL A PYTHON) =====
function calcularVLSM(ipBase,hosts){
    hosts.sort((a,b)=>b-a);
    let subredActual=redBase24(ipBase);
    let res=[];

    for(let h of hosts){
        const bits=Math.ceil(Math.log2(h+2));
        const pref=32-bits;
        const tam=2**bits;

        const net=subredActual;
        const ph=net+1;
        const uh=net+tam-2;
        const bc=net+tam-1;

        res.push({
            red:intToIp(net),
            pref:`/${pref}`,
            mask:mascaraDesdePrefijo(pref),
            hr:h,
            hd:tam-2,
            ph:intToIp(ph),
            uh:intToIp(uh),
            bc:intToIp(bc)
        });

        subredActual=bc+1;
    }
    return res;
}

// ===== INTERFAZ =====
const btn=document.getElementById("btn-calcular");
const tabla=document.getElementById("tabla-body");
const loading=document.getElementById("loading");
const errorBox=document.getElementById("error-message");
const stats=document.getElementById("stats");

btn.onclick=()=>{
    loading.style.display="flex";
    errorBox.style.display="none";

    setTimeout(()=>{
        try{
            const ip=document.getElementById("ip-base").value.trim();
            const hosts=document.getElementById("hosts").value
                .split(",").map(x=>parseInt(x.trim()));

            const r=calcularVLSM(ip,hosts);
            tabla.innerHTML="";
            stats.innerHTML="";

            let req=0, disp=0;
            r.forEach(x=>{
                req+=x.hr; disp+=x.hd;
                tabla.innerHTML+=`
                <tr>
                <td><span class="ip-cell">${x.red}</span></td>
                <td>${x.pref}</td>
                <td><span class="ip-cell">${x.mask}</span></td>
                <td>${x.hr}</td>
                <td>${x.hd}</td>
                <td><span class="ip-cell">${x.ph}</span></td>
                <td><span class="ip-cell">${x.uh}</span></td>
                <td style="color:#e74c3c">${x.bc}</td>
                </tr>`;
            });

            stats.innerHTML=`
            <div class="stat-box"><span class="stat-value">${r.length}</span><span class="stat-label">Subredes</span></div>
            <div class="stat-box"><span class="stat-value">${req}</span><span class="stat-label">Hosts Req</span></div>
            <div class="stat-box"><span class="stat-value">${disp}</span><span class="stat-label">Hosts Disp</span></div>
            <div class="stat-box"><span class="stat-value">${((req/disp)*100).toFixed(1)}%</span><span class="stat-label">Eficiencia</span></div>
            `;
        }catch(e){
            errorBox.textContent=e.message;
            errorBox.style.display="block";
        }finally{
            loading.style.display="none";
        }
    },300);
};
</script>
</body>
</html>
